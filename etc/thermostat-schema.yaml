# https://pykwalify.readthedocs.io/en/master/index.html


schema;priceOverrides:
    mapping:
        price:
            type: float
            range: { min: 0.0, max: 9.0 }
        comfortMin:
            type: float
            range: { min: 0.0, max: 100.0 }
        comfortMax:
            type: float
            range: { min: 0.0, max: 100.0 }

# schema;schedule:
#     type: map
#     mapping:
#         days:
#             type: seq

# Schema
type: map
mapping:
    thermostat:
        type: map
        mapping:
            delta: { type: float, range: { min: 0, max: 2 } }
            fanRunout: { type: int, range: { min: 0, max: 30 } }
            backlightTimeout: { type: int, range: { min: 1, max: 60 } }
            defaults:
                type: map
                matching-rule: 'any'
                mapping:
                    comfortMin: { type: float, range: { min: 0.0, max: 100.0 } }
                    comfortMax: { type: float, range: { min: 0.0, max: 100.0 } }
                    priceOverrides:
                        type: seq
                        sequence:
                            - include: priceOverrides
            programs:
                type: map
                matching-rule: 'all'
                mapping:
                    regex;(.+):
                        type: map
                        mapping:
                            comfortMin: { type: float, range: { min: 0.0, max: 100.0 } }
                            comfortMax: { type: float, range: { min: 0.0, max: 100.0 } }
                            priceOverrides:
                                type: seq
                                sequence:
                                    - include: priceOverrides
            schedule:
                type: map
                matching-rule: 'all'
                mapping:
                    regex;(.+):
                        type: map
                        mapping:
                            days:
                                type: seq
                                sequence:
                                    - { type: int, range: { min: 0, max: 6 } }
                            times:
                                type: seq
                                sequence:
                                    - type: map
                                      mapping:
                                        hour:
                                            type: int
                                            range: { min: 0, max: 23 }
                                        minute:
                                            type: int
                                            range: { min: 0, max: 59 }
                                        program:
                                            type: str
            priceOverrides:
                type: seq
                sequence:
                    - include: priceOverrides
    gogriddy:
        type: map
        mapping:
            enabled: { type: bool }
            meterID: { type: str }
            memberID: { type: str }
            settlementPoint: { type: str }
            apiUrl: { type: str }


# thermostat:
#     delta: 1.0
#     fanRunout: 30
#     backlightTimeout: 10
#     defaults: { comfortMin: 68, comfortMax: 76 }

#     programs:
#         overnight: { comfortMin: 68, comfortMax: 73 }
#         home: { comfortMin: 70, comfortMax: 76 }
#         away: { comfortMin: 64, comfortMax: 80 }

#     schedule:
#         work week:
#             days: [0, 1, 2, 3, 4]
#             times:
#                 - { hour: 8, minute: 0, program: away }
#                 - { hour: 17, minute: 0, program: home }
#                 - { hour: 20, minute: 0, program: overnight }
#         weekend:
#             days: [5, 6]
#             times:
#                 - { hour: 8, minute: 0, program: home }
#                 - { hour: 20, minute: 0, program: overnight }
           
#     priceOverrides:
#         - { price: 0.25, comfortMax: 78 }
#         - { price: 0.50, comfortMax: 80 }
#         - { price: 1.00, comfortMax: 88 }

# gogriddy:
#     enabled: true
#     meterID: 1008901023809085840100
#     memberID: 32795
#     settlementPoint: LZ_HOUSTON
#     apiUrl: https://app.gogriddy.com/api/v1/insights/getnow
